# ESLint Rule Message Format - LLM Optimization Standard

## Overview

All ESLint rule messages in this package MUST follow the **4-line LLM-optimized format**. This ensures consistency, clarity, and enables LLMs (Large Language Models) to understand and fix violations accurately.

## Format Structure

Every error/warning message MUST have exactly 4 lines:

```
Line 1: [Icon] [Issue Name] (CWE-XXX) | [Severity Level]
Line 2:    âŒ Current: [Bad practice example]
Line 3:    âœ… Fix: [Solution with pattern/code]
Line 4:    ğŸ“š [Documentation Link] or [Context]
```

## Line Breakdown

### Line 1: Icon + Issue Name + CWE + Severity
- **Icon**: Use category-specific emoji (ğŸ”’ security issues, âš ï¸ warnings, ğŸ”„ refactoring/architecture, â™¿ accessibility, âš¡ performance, ğŸ“š domain, ğŸš« module/import)
- **Issue Name**: Brief name of the issue/violation
- **CWE Reference**: Include CWE number (CWE-XXX format) - applies to ALL rule types
- **Severity**: One of: `CRITICAL`, `HIGH`, `MEDIUM`, `LOW`

**Example:**
```
ğŸ”’ SQL Injection (CWE-89) | CRITICAL
```

### Line 2: Current Bad Practice
- Show the problematic code/pattern
- Use `âŒ Current:` prefix
- Include minimal code snippet or description
- Indent with 3 spaces for alignment

**Example:**
```
   âŒ Current: `SELECT * FROM users WHERE id = ${userId}`
```

### Line 3: Fix with Solution
- Show how to fix the issue
- Use `âœ… Fix:` prefix
- Include working pattern or code
- May span multiple lines if needed
- Indent with 3 spaces for alignment

**Example:**
```
   âœ… Fix: Use parameterized query: db.query("SELECT * FROM users WHERE id = ?", [userId])
```

### Line 4: Documentation
- Provide relevant documentation link
- Include context about why this matters
- Use `ğŸ“š` prefix
- Indent with 3 spaces for alignment

**Example:**
```
   ğŸ“š https://owasp.org/www-community/attacks/SQL_Injection
```

## CWE Reference Guide

Common CWE mappings for security/code quality issues:

| Category | CWE | Examples |
|----------|-----|----------|
| **Injection** | CWE-89 | SQL Injection |
| | CWE-78 | Command Injection |
| | CWE-95 | Code Injection (eval, require) |
| **Path Traversal** | CWE-22 | Path traversal attacks |
| **Regex** | CWE-400 | ReDoS (Regular Expression Denial of Service) |
| **Prototype Pollution** | CWE-915 | Object injection |
| **Module Issues** | CWE-407 | Circular dependencies |
| | CWE-431 | Insecure dependency |
| **Logging** | CWE-532 | Sensitive data logging |
| **API** | CWE-1078 | Deprecated/obsolete components |
| **Code Quality** | CWE-1104 | Code duplication |

## Severity Levels

- **CRITICAL**: Security vulnerability, will break functionality, immediate fix required
- **HIGH**: Important issue affecting security or core functionality
- **MEDIUM**: Best practice violation or performance concern
- **LOW**: Code style or minor optimization

## Implementation Example

### Bad Message (Old Style)
```typescript
messages: {
  sqlInjection: 'âš ï¸ SQL Injection detected | {{filePath}}:{{line}}'
}
```

### Good Message (LLM-Optimized)
```typescript
messages: {
  sqlInjection:
    'ğŸ”’ SQL Injection (CWE-89) | CRITICAL\n' +
    '   âŒ Current: `SELECT * FROM users WHERE id = ${userId}`\n' +
    '   âœ… Fix: Use parameterized query: db.query("SELECT * FROM users WHERE id = ?", [userId])\n' +
    '   ğŸ“š https://owasp.org/www-community/attacks/SQL_Injection',
}
```

## Data Object Fields

When calling `context.report()`, include these fields in the `data` object:

```typescript
context.report({
  node,
  messageId: 'ruleName',
  data: {
    // Line 1 substitutions
    severity: 'CRITICAL',  // or HIGH, MEDIUM, LOW
    
    // Line 2 substitutions
    current: '...',        // Current bad pattern
    
    // Line 3 substitutions
    fix: '...',            // Suggested fix
    solution: '...',       // Alternative fix approach
    
    // Line 4 substitutions
    documentation: '...',  // Doc link
    reason: '...',         // Why this matters
    
    // Context for placeholders
    filePath: '...',
    line: '...',
  },
});
```

## Template Examples

### Generic Rule Template (Works for ALL Categories)

```typescript
messages: {
  ruleName:
    '[Icon] [Issue Name] (CWE-XXX) | {{severity}}\n' +
    '   âŒ Current: {{currentBadExample}}\n' +
    '   âœ… Fix: {{solution}}\n' +
    '   ğŸ“š {{documentationLink}}',
}
```

### Example: Security Rule

```typescript
messages: {
  sqlInjection:
    'ğŸ”’ SQL Injection (CWE-89) | CRITICAL\n' +
    '   âŒ Current: `SELECT * FROM users WHERE id = ${userId}`\n' +
    '   âœ… Fix: Use parameterized query: db.query("SELECT * FROM users WHERE id = ?", [userId])\n' +
    '   ğŸ“š https://owasp.org/www-community/attacks/SQL_Injection',
}
```

### Example: Architecture Rule

```typescript
messages: {
  circularDependency:
    'ğŸ”„ Circular Dependency (CWE-407) | HIGH\n' +
    '   âŒ Current: A â†’ B â†’ A (creates cycle)\n' +
    '   âœ… Fix: Split into 3 modules: A.core â†’ B â†’ A.extended\n' +
    '   ğŸ“š https://en.wikipedia.org/wiki/Circular_dependency',
}
```

### Example: Performance Rule

```typescript
messages: {
  inlineFunction:
    'âš¡ Inline Function (CWE-1104) | MEDIUM\n' +
    '   âŒ Current: Inline function in render causes re-renders\n' +
    '   âœ… Fix: Use useCallback or extract to component method\n' +
    '   ğŸ“š https://react.dev/reference/react/useCallback',
}
```

### Example: Accessibility Rule

```typescript
messages: {
  missingAltText:
    'â™¿ Missing Alt Text (CWE-252) | CRITICAL\n' +
    '   âŒ Current: <img> without alt attribute\n' +
    '   âœ… Fix: Add alt="descriptive text" or alt="" for decorative images\n' +
    '   ğŸ“š https://www.w3.org/WAI/tutorials/images/',
}
```

### Example: Code Quality Rule

```typescript
messages: {
  duplicateFunction:
    'ğŸ”„ Duplicate Implementation (CWE-1104) | MEDIUM\n' +
    '   âŒ Current: 3 identical functions with 95% similarity\n' +
    '   âœ… Fix: Extract to shared utility function\n' +
    '   ğŸ“š https://en.wikipedia.org/wiki/Don%27t_repeat_yourself',
}
```

## Guidelines

### DO âœ…

- âœ… Always include CWE reference
- âœ… Use exactly 4 lines (with newlines)
- âœ… Include both current bad example AND fix
- âœ… Provide actionable solutions
- âœ… Include relevant documentation links
- âœ… Use appropriate severity levels
- âœ… Use 3-space indentation for lines 2-4
- âœ… Include emoji icons for visual scanning
- âœ… Test messages with actual violations

### DON'T âŒ

- âŒ Skip CWE references
- âŒ Use vague or unclear examples
- âŒ Provide only problems without solutions
- âŒ Include multiple unrelated concepts in one message
- âŒ Use unclear abbreviations
- âŒ Forget to update data object fields
- âŒ Create biased rules that favor specific cases
- âŒ Add special logic for certain attributes/cases

## Testing Your Rule

1. **Syntax Check**: Verify newlines render correctly
2. **Coverage**: Test with both pass and fail cases
3. **Clarity**: Can a developer understand the fix?
4. **LLM Readiness**: Can an AI parse the structure?
5. **Consistency**: Does it match other rules?

Run: `nx lint` on playground to verify formatting

## Resources

- **ESLint Rule API**: https://eslint.org/docs/extend/custom-rules
- **CWE Database**: https://cwe.mitre.org/
- **OWASP Reference**: https://owasp.org/
- **See existing rules**: `src/rules/` directory for examples

---

**Last Updated**: 2025-11-02
**Version**: 1.0
**Status**: Active Standard
