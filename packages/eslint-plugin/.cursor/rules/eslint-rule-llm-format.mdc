# ESLint Rule Message Format - LLM Optimization Standard

## Overview

All ESLint rule messages in this package MUST follow the **2-line LLM-optimized format** using the `formatLLMMessage` utility from `@forge-js/eslint-plugin-utils`. This ensures consistency, clarity, and enables LLMs (Large Language Models) to understand and fix violations accurately.

## Format Structure

Every error/warning message MUST use `formatLLMMessage` which produces exactly 2 lines:

```
Line 1: [Icon] [CWE?] | [Description] | [SEVERITY]
Line 2:    Fix: [fix instruction] | [documentation link]
```

**Note:** CWE is optional - only include when relevant to the rule type (security, high-impact issues).

## Line Breakdown

### Line 1: Icon + CWE + Description + Severity

- **Icon**: Use `MessageIcons` constants from `@forge-js/eslint-plugin-utils` (e.g., `MessageIcons.SECURITY`, `MessageIcons.WARNING`)
- **CWE Reference**: Include CWE number (CWE-XXX format) **ONLY if relevant to the rule**
  - Include for: Security, high-impact architecture, critical bugs
  - Skip for: Naming conventions, minor style issues, personal preferences
- **Description**: Full description of the issue (e.g., "SQL Injection detected", "console.log found in production code")
- **Severity**: One of: `CRITICAL`, `HIGH`, `MEDIUM`, `LOW`

**Example:**

```
üîí CWE-89 | SQL Injection detected | CRITICAL
```

### Line 2: Fix Instruction + Documentation

- Show how to fix the issue
- Use `Fix:` prefix (no emoji)
- Include specific fix instruction with code example
- Include documentation link separated by `|`
- Indent with 3 spaces for alignment

**Example:**

```
   Fix: Use parameterized query: db.query("SELECT * FROM users WHERE id = ?", [userId]) | https://owasp.org/www-community/attacks/SQL_Injection
```

## CWE Reference Guide

Common CWE mappings for security and high-impact code quality issues. **Use when relevant to your rule:**

| Category                | CWE      | Examples                                     |
| ----------------------- | -------- | -------------------------------------------- |
| **Injection**           | CWE-89   | SQL Injection                                |
|                         | CWE-78   | Command Injection                            |
|                         | CWE-95   | Code Injection (eval, require)               |
| **Path Traversal**      | CWE-22   | Path traversal attacks                       |
| **Regex**               | CWE-400  | ReDoS (Regular Expression Denial of Service) |
| **Prototype Pollution** | CWE-915  | Object injection                             |
| **Module Issues**       | CWE-407  | Circular dependencies                        |
|                         | CWE-431  | Insecure dependency                          |
| **Logging**             | CWE-532  | Sensitive data logging                       |
| **API**                 | CWE-1078 | Deprecated/obsolete components               |
| **Code Quality**        | CWE-1104 | Code duplication                             |

## Severity Levels

- **CRITICAL**: Security vulnerability, will break functionality, immediate fix required
- **HIGH**: Important issue affecting security or core functionality
- **MEDIUM**: Best practice violation or performance concern
- **LOW**: Code style or minor optimization

## Implementation Example

### Bad Message (Old Style)

```typescript
messages: {
  sqlInjection: '‚ö†Ô∏è SQL Injection detected | {{filePath}}:{{line}}';
}
```

### Good Message (LLM-Optimized)

```typescript
import { formatLLMMessage, MessageIcons } from '@forge-js/eslint-plugin-utils';

messages: {
  sqlInjection: formatLLMMessage({
    icon: MessageIcons.SECURITY,
    issueName: 'SQL Injection',
    cwe: 'CWE-89',
    description: 'SQL Injection detected',
    severity: 'CRITICAL',
    fix: 'Use parameterized query: db.query("SELECT * FROM users WHERE id = ?", [userId])',
    documentationLink: 'https://owasp.org/www-community/attacks/SQL_Injection',
  }),
}
```

**Output:**

```
üîí CWE-89 | SQL Injection detected | CRITICAL
   Fix: Use parameterized query: db.query("SELECT * FROM users WHERE id = ?", [userId]) | https://owasp.org/www-community/attacks/SQL_Injection
```

## Data Object Fields

When calling `context.report()`, include these fields in the `data` object:

```typescript
context.report({
  node,
  messageId: 'ruleName',
  data: {
    // Line 1 substitutions
    severity: 'CRITICAL', // or HIGH, MEDIUM, LOW

    // Line 2 substitutions
    current: '...', // Current bad pattern

    // Line 3 substitutions
    fix: '...', // Suggested fix
    solution: '...', // Alternative fix approach

    // Line 4 substitutions
    documentation: '...', // Doc link
    reason: '...', // Why this matters

    // Context for placeholders
    filePath: '...',
    line: '...',
  },
});
```

## Template Examples

### Generic Rule Template (Works for ALL Categories)

```typescript
import { formatLLMMessage, MessageIcons } from '@forge-js/eslint-plugin-utils';

messages: {
  ruleName: formatLLMMessage({
    icon: MessageIcons.SECURITY, // or appropriate icon
    issueName: 'Issue Name',
    cwe: 'CWE-XXX', // optional, only if relevant
    description: 'Issue description',
    severity: 'CRITICAL', // or HIGH, MEDIUM, LOW
    fix: 'Specific fix instruction with code example',
    documentationLink: 'https://example.com/docs',
  }),
}
```

### Example: Security Rule

```typescript
import { formatLLMMessage, MessageIcons } from '@forge-js/eslint-plugin-utils';

messages: {
  sqlInjection: formatLLMMessage({
    icon: MessageIcons.SECURITY,
    issueName: 'SQL Injection',
    cwe: 'CWE-89',
    description: 'SQL Injection detected',
    severity: 'CRITICAL',
    fix: 'Use parameterized query: db.query("SELECT * FROM users WHERE id = ?", [userId])',
    documentationLink: 'https://owasp.org/www-community/attacks/SQL_Injection',
  }),
}
```

### Example: Architecture Rule

```typescript
import { formatLLMMessage, MessageIcons } from '@forge-js/eslint-plugin-utils';

messages: {
  circularDependency: formatLLMMessage({
    icon: MessageIcons.ARCHITECTURE,
    issueName: 'Circular Dependency',
    cwe: 'CWE-407',
    description: 'Circular dependency detected',
    severity: 'HIGH',
    fix: 'Extract shared types to types.ts, break cycle at C.ts',
    documentationLink: 'https://en.wikipedia.org/wiki/Circular_dependency',
  }),
}
```

### Example: Performance Rule

```typescript
import { formatLLMMessage, MessageIcons } from '@forge-js/eslint-plugin-utils';

messages: {
  inlineFunction: formatLLMMessage({
    icon: MessageIcons.PERFORMANCE,
    issueName: 'Inline Function',
    cwe: 'CWE-1104',
    description: 'Inline function in render causes re-renders',
    severity: 'MEDIUM',
    fix: 'Use useCallback or extract to component method',
    documentationLink: 'https://react.dev/reference/react/useCallback',
  }),
}
```

### Example: Accessibility Rule

```typescript
import { formatLLMMessage, MessageIcons } from '@forge-js/eslint-plugin-utils';

messages: {
  missingAltText: formatLLMMessage({
    icon: MessageIcons.ACCESSIBILITY,
    issueName: 'Missing Alt Text',
    cwe: 'CWE-252',
    description: 'Missing alt attribute on image',
    severity: 'CRITICAL',
    fix: 'Add alt="descriptive text" or alt="" for decorative images',
    documentationLink: 'https://www.w3.org/WAI/tutorials/images/',
  }),
}
```

### Example: Code Quality Rule

```typescript
import { formatLLMMessage, MessageIcons } from '@forge-js/eslint-plugin-utils';

messages: {
  duplicateFunction: formatLLMMessage({
    icon: MessageIcons.DUPLICATION,
    issueName: 'Duplicate Implementation',
    cwe: 'CWE-1104',
    description: 'Duplicate function implementation detected',
    severity: 'MEDIUM',
    fix: 'Extract to shared utility function',
    documentationLink: 'https://en.wikipedia.org/wiki/Don%27t_repeat_yourself',
  }),
}
```

## Guidelines

### DO ‚úÖ

- ‚úÖ **ALWAYS use `formatLLMMessage` utility** from `@forge-js/eslint-plugin-utils`
- ‚úÖ Use exactly 2 lines (generated by `formatLLMMessage`)
- ‚úÖ Include specific fix instruction with code example
- ‚úÖ Provide actionable solutions
- ‚úÖ Include relevant documentation links
- ‚úÖ Use appropriate severity levels
- ‚úÖ Use `MessageIcons` constants for icons
- ‚úÖ **Include CWE ONLY when relevant** (security, high-impact)
- ‚úÖ Test messages with actual violations

### DON'T ‚ùå

- ‚ùå Skip CWE when it's clearly relevant (security)
- ‚ùå Use vague or unclear examples
- ‚ùå Provide only problems without solutions
- ‚ùå Include multiple unrelated concepts in one message
- ‚ùå Use unclear abbreviations
- ‚ùå Forget to update data object fields
- ‚ùå Create biased rules that favor specific cases
- ‚ùå Add special logic for certain attributes/cases
- ‚ùå Force CWE into unrelated rules

## Testing Your Rule

1. **Syntax Check**: Verify newlines render correctly
2. **Coverage**: Test with both pass and fail cases
3. **Clarity**: Can a developer understand the fix?
4. **LLM Readiness**: Can an AI parse the structure?
5. **Consistency**: Does it match other rules?

Run: `nx lint` on playground to verify formatting

## Rules WITHOUT CWE Examples

When CWE is not relevant, omit it:

### Example: Naming Convention Rule (No CWE)

```typescript
import { formatLLMMessage, MessageIcons } from '@forge-js/eslint-plugin-utils';

messages: {
  wrongNaming: formatLLMMessage({
    icon: MessageIcons.DOMAIN,
    issueName: 'Domain Naming',
    description: 'Domain terminology mismatch',
    severity: 'MEDIUM',
    fix: 'Use "{{correctTerm}}" ({{context}}) for ubiquitous language alignment',
    documentationLink: 'Domain glossary',
  }),
}
```

### Example: Style/Format Rule (No CWE)

```typescript
import { formatLLMMessage, MessageIcons } from '@forge-js/eslint-plugin-utils';

messages: {
  consistentFormatting: formatLLMMessage({
    icon: MessageIcons.WARNING,
    issueName: 'Inconsistent Formatting',
    description: 'Inconsistent formatting detected',
    severity: 'LOW',
    fix: 'Use consistent 2-space indentation',
    documentationLink: 'See project style guide',
  }),
}
```

### Example: Refactoring Suggestion (No CWE)

```typescript
import { formatLLMMessage, MessageIcons } from '@forge-js/eslint-plugin-utils';

messages: {
  refactorSuggestion: formatLLMMessage({
    icon: MessageIcons.MIGRATION,
    issueName: 'Simplification Opportunity',
    description: 'Nested ternary operators (hard to read)',
    severity: 'LOW',
    fix: 'Extract to helper function or early returns',
    documentationLink: 'Improves code maintainability',
  }),
}
```

## Resources

- **ESLint Rule API**: https://eslint.org/docs/extend/custom-rules
- **CWE Database**: https://cwe.mitre.org/
- **OWASP Reference**: https://owasp.org/
- **See existing rules**: `src/rules/` directory for examples

---

**Last Updated**: 2025-11-02
**Version**: 1.0
**Status**: Active Standard
